{
  "version": 3,
  "sources": ["../src/tools.js", "../src/index.js"],
  "sourcesContent": ["export const numOrZero = num=>{ \r\n    const n = Number(num);\r\n    return isNaN(n) ? 0 : Math.max(0, n);\r\n}\r\n\r\nexport const toArray = any=>{\r\n    if (any == null) { return []; }\r\n    if (Array.isArray(any)) { return any; }\r\n    return [ any ];\r\n}", "import { numOrZero, toArray } from \"./tools\";\n\nconst _pass = [\"all\", \"first\", \"last\"];\n\nexport class Queue extends Function {\n\n    constructor(processTasks, opt={}) {\n        super();\n\n        opt = typeof opt === \"object\" ? opt : {};\n\n        if (typeof processTasks !== \"function\") { throw Error(\"Queue(...) expect first argument to be function\"); }\n\n        if (!opt.pass) { opt.pass = \"all\"; }\n        else if (!_pass.includes(opt.pass)) { throw Error(`Queue(...) expect opt.pass to be one of: '${_pass.join(\"|\")}'`); }\n        \n        const args = toArray(opt.args);\n        const pass = opt.pass;\n        const softMs = numOrZero(opt.softMs);\n        const hardMs = numOrZero(opt.hardMs);\n        const maxSize = numOrZero(opt.maxSize);\n        const hardMsActive = hardMs > softMs;\n\n        let pcq, intA, intB, startAt, tasks = [];\n\n        if (pass === \"all\") { pcq = q=>processTasks(...args, q); }\n        else if (pass === \"first\") { pcq = q=>processTasks(...args, ...q[0]); }\n        else if (pass === \"last\") { pcq = q=>processTasks(...args, ...q[q.length-1]); }\n\n        const execute = _=>{\n            clearTimeout(intA);\n            clearTimeout(intB);\n            const q = tasks;\n            tasks = [];\n            startAt = undefined;\n            pcq(q);\n        };\n\n        const call = (...args)=>{\n            clearTimeout(intA);\n            tasks.push(args);\n            if (maxSize && tasks.length >= maxSize) { return execute(); }\n\n            intA = setTimeout(execute, softMs);\n            if (tasks.length !== 1) { return; }\n\n            startAt = Date.now();\n            if (hardMsActive) { intB = setTimeout(execute, hardMs); }\n        }\n\n        const self = Object.setPrototypeOf(call, new.target.prototype);\n\n        Object.defineProperties(self, {\n            isPending:{ enumerable:true, get:_=>!!startAt },\n            size:{ enumerable:true, get:_=>tasks.length },\n            startAt:{ enumerable:true, get:_=>startAt },\n            softEndAt:{ enumerable:true, get:_=>!startAt ? undefined : (startAt + softMs) },\n            hardEndAt:{ enumerable:true, get:_=>(!startAt || !hardMsActive) ? undefined : (startAt + hardMs) }\n        });\n\n        return self;\n    }\n}\n\nexport const createQueue = (processTasks, opt={})=>new Queue(processTasks, opt);\n\nexport default createQueue;"],
  "mappings": ";AAAO,IAAM,YAAY,SAAK;AAC1B,QAAM,IAAI,OAAO,GAAG;AACpB,SAAO,MAAM,CAAC,IAAI,IAAI,KAAK,IAAI,GAAG,CAAC;AACvC;AAEO,IAAM,UAAU,SAAK;AACxB,MAAI,OAAO,MAAM;AAAE,WAAO,CAAC;AAAA,EAAG;AAC9B,MAAI,MAAM,QAAQ,GAAG,GAAG;AAAE,WAAO;AAAA,EAAK;AACtC,SAAO,CAAE,GAAI;AACjB;;;ACPA,IAAM,QAAQ,CAAC,OAAO,SAAS,MAAM;AAE9B,IAAM,QAAN,cAAoB,SAAS;AAAA,EAEhC,YAAY,cAAc,MAAI,CAAC,GAAG;AAC9B,UAAM;AAEN,UAAM,OAAO,QAAQ,WAAW,MAAM,CAAC;AAEvC,QAAI,OAAO,iBAAiB,YAAY;AAAE,YAAM,MAAM,iDAAiD;AAAA,IAAG;AAE1G,QAAI,CAAC,IAAI,MAAM;AAAE,UAAI,OAAO;AAAA,IAAO,WAC1B,CAAC,MAAM,SAAS,IAAI,IAAI,GAAG;AAAE,YAAM,MAAM,6CAA6C,MAAM,KAAK,GAAG,IAAI;AAAA,IAAG;AAEpH,UAAM,OAAO,QAAQ,IAAI,IAAI;AAC7B,UAAM,OAAO,IAAI;AACjB,UAAM,SAAS,UAAU,IAAI,MAAM;AACnC,UAAM,SAAS,UAAU,IAAI,MAAM;AACnC,UAAM,UAAU,UAAU,IAAI,OAAO;AACrC,UAAM,eAAe,SAAS;AAE9B,QAAI,KAAK,MAAM,MAAM,SAAS,QAAQ,CAAC;AAEvC,QAAI,SAAS,OAAO;AAAE,YAAM,OAAG,aAAa,GAAG,MAAM,CAAC;AAAA,IAAG,WAChD,SAAS,SAAS;AAAE,YAAM,OAAG,aAAa,GAAG,MAAM,GAAG,EAAE,CAAC,CAAC;AAAA,IAAG,WAC7D,SAAS,QAAQ;AAAE,YAAM,OAAG,aAAa,GAAG,MAAM,GAAG,EAAE,EAAE,SAAO,CAAC,CAAC;AAAA,IAAG;AAE9E,UAAM,UAAU,OAAG;AACf,mBAAa,IAAI;AACjB,mBAAa,IAAI;AACjB,YAAM,IAAI;AACV,cAAQ,CAAC;AACT,gBAAU;AACV,UAAI,CAAC;AAAA,IACT;AAEA,UAAM,OAAO,IAAIA,UAAO;AACpB,mBAAa,IAAI;AACjB,YAAM,KAAKA,KAAI;AACf,UAAI,WAAW,MAAM,UAAU,SAAS;AAAE,eAAO,QAAQ;AAAA,MAAG;AAE5D,aAAO,WAAW,SAAS,MAAM;AACjC,UAAI,MAAM,WAAW,GAAG;AAAE;AAAA,MAAQ;AAElC,gBAAU,KAAK,IAAI;AACnB,UAAI,cAAc;AAAE,eAAO,WAAW,SAAS,MAAM;AAAA,MAAG;AAAA,IAC5D;AAEA,UAAM,OAAO,OAAO,eAAe,MAAM,WAAW,SAAS;AAE7D,WAAO,iBAAiB,MAAM;AAAA,MAC1B,WAAU,EAAE,YAAW,MAAM,KAAI,OAAG,CAAC,CAAC,QAAQ;AAAA,MAC9C,MAAK,EAAE,YAAW,MAAM,KAAI,OAAG,MAAM,OAAO;AAAA,MAC5C,SAAQ,EAAE,YAAW,MAAM,KAAI,OAAG,QAAQ;AAAA,MAC1C,WAAU,EAAE,YAAW,MAAM,KAAI,OAAG,CAAC,UAAU,SAAa,UAAU,OAAQ;AAAA,MAC9E,WAAU,EAAE,YAAW,MAAM,KAAI,OAAI,CAAC,WAAW,CAAC,eAAgB,SAAa,UAAU,OAAQ;AAAA,IACrG,CAAC;AAED,WAAO;AAAA,EACX;AACJ;AAEO,IAAM,cAAc,CAAC,cAAc,MAAI,CAAC,MAAI,IAAI,MAAM,cAAc,GAAG;AAE9E,IAAO,cAAQ;",
  "names": ["args"]
}
