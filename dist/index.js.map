{
  "version": 3,
  "sources": ["<define:__slib_info>", "../node_modules/@randajan/simple-lib/src/tools/logger.js", "../node_modules/@randajan/simple-lib/src/info/index.js", "../node_modules/@randajan/simple-lib/src/lib/index.js", "../src/tools.js", "../src/index.js"],
  "sourcesContent": ["", "import chalkNative from \"chalk\";\r\n\r\nconst chalkProps = Object.getOwnPropertyNames(Object.getPrototypeOf(chalkNative)).filter(v=>v!==\"constructor\");\r\n\r\nclass Logger extends Function {\r\n    constructor(formater, chalkInit) {\r\n        super();\r\n        const chalk = chalkInit||chalkNative;\r\n\r\n        const log = (...msgs)=>{ console.log(chalk(formater(msgs))); }\r\n        const self = Object.setPrototypeOf(log.bind(), new.target.prototype);\r\n\r\n        for (const prop of chalkProps) {\r\n            Object.defineProperty(self, prop, { get: _=>new Logger(formater, chalk[prop]), enumerable:false });\r\n        }\r\n        \r\n        return self;\r\n    }\r\n}\r\n\r\nexport const logger = (...prefixes)=>{\r\n    const now = _=>(new Date()).toLocaleTimeString(\"cs-CZ\");\r\n    prefixes = prefixes.filter(v=>!!v).join(\" \");\r\n\r\n    return new Logger(msgs=>`${prefixes} | ${now()} | ${msgs.join(\" \")}`);\r\n}", "const enumerable = true;\r\nconst lockObject = o=>{\r\n    if (typeof o !== \"object\") { return o; }\r\n\r\n    const r = {};\r\n    for (const i in o) {\r\n        const descriptor = { enumerable };\r\n        let val = o[i];\r\n        if (val instanceof Array) { descriptor.get = _=>[...val]; }\r\n        else { descriptor.value = lockObject(val); }\r\n        Object.defineProperty(r, i, descriptor);\r\n    }\r\n\r\n    return r;\r\n}\r\n\r\nexport const info = lockObject(__slib_info);\r\nexport default info;", "import { info } from \"../info\";\r\nimport { logger } from \"../tools/logger\";\r\n\r\nexport default info;\r\n\r\nexport const log = logger(info.name, info.version, info.env);\r\n\r\nexport {\r\n    info,\r\n}", "export const numOrZero = num=>{ \r\n    const n = Number(num);\r\n    return isNaN(n) ? 0 : Math.max(0, n);\r\n}\r\n\r\nexport const toArray = any=>{\r\n    if (any == null) { return []; }\r\n    if (Array.isArray(any)) { return any; }\r\n    return [ any ];\r\n}", "\nimport { info, log } from \"@randajan/simple-lib/lib\";\nimport { numOrZero, toArray } from \"./tools\";\n\nconst _pass = [\"all\", \"first\", \"last\"];\n\nexport class Queue extends Function {\n\n    constructor(processTasks, opt={}) {\n        super();\n\n        opt = typeof opt === \"object\" ? opt : {};\n\n        if (typeof processTasks !== \"function\") { throw Error(\"Queue(...) expect first argument to be function\"); }\n\n        if (!opt.pass) { opt.pass = \"all\"; }\n        else if (!_pass.includes(opt.pass)) { throw Error(`Queue(...) expect opt.pass to be one of: '${_pass.join(\"|\")}'`); }\n        \n        const args = toArray(opt.args);\n        const pass = opt.pass;\n        const softMs = numOrZero(opt.softMs);\n        const hardMs = numOrZero(opt.hardMs);\n        const maxSize = numOrZero(opt.maxSize);\n        const hardMsActive = hardMs > softMs;\n\n        let pcq, intA, intB, startAt, tasks = [];\n\n        if (pass === \"all\") { pcq = q=>processTasks(...args, q); }\n        else if (pass === \"first\") { pcq = q=>processTasks(...args, ...q[0]); }\n        else if (pass === \"last\") { pcq = q=>processTasks(...args, ...q[q.length-1]); }\n\n        const execute = _=>{\n            clearTimeout(intA);\n            clearTimeout(intB);\n            const q = tasks;\n            tasks = [];\n            startAt = undefined;\n            pcq(q);\n        };\n\n        const call = (...args)=>{\n            clearTimeout(intA);\n            tasks.push(args);\n            if (maxSize && tasks.length >= maxSize) { return execute(); }\n\n            intA = setTimeout(execute, softMs);\n            if (tasks.length !== 1) { return; }\n\n            startAt = Date.now();\n            if (hardMsActive) { intB = setTimeout(execute, hardMs); }\n        }\n\n        const self = Object.setPrototypeOf(call, new.target.prototype);\n\n        Object.defineProperties(self, {\n            isPending:{ enumerable:true, get:_=>!!startAt },\n            size:{ enumerable:true, get:_=>tasks.length },\n            startAt:{ enumerable:true, get:_=>startAt },\n            bufferEndAt:{ enumerable:true, get:_=>!startAt ? undefined : (startAt + softMs) },\n            queueEndAt:{ enumerable:true, get:_=>(!startAt || !hardMsActive) ? undefined : (startAt + hardMs) }\n        });\n\n        return self;\n    }\n}\n\nexport const createQueue = (processTasks, opt={})=>new Queue(processTasks, opt);\n\nexport default createQueue;"],
  "mappings": "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",
  "names": ["log", "args"]
}
